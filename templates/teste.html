<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <title>Teste de Cadastro</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet">
</head>
<body>
<div class="container mt-5">
  <h3>Cadastro de Cliente</h3>
  <form>

    <!-- CPF/CNPJ -->
    <div class="mb-3">
      <label>CPF ou CNPJ</label>
      <div class="input-group">
        <input type="text" id="cpf_cnpj" class="form-control" placeholder="00.000.000/0000-00">
        <button type="button" class="btn btn-outline-secondary" id="buscar_cnpj">
          <i class="bi bi-search"></i>
        </button>
      </div>
    </div>

    <!-- Dados da empresa -->
    <div class="mb-3">
      <label>Raz칚o Social</label>
      <input type="text" id="razao_social" class="form-control">
    </div>

    <div class="mb-3">
      <label>Nome Fantasia</label>
      <input type="text" id="nome_fantasia" class="form-control">
    </div>

    <!-- Endere칞o -->
    <div class="mb-3">
      <label>CEP</label>
      <input type="text" id="cep" class="form-control" placeholder="79000-000">
    </div>

    <div class="mb-3">
      <label>Logradouro</label>
      <input type="text" id="logradouro" class="form-control">
    </div>

    <div class="mb-3">
      <label>N칰mero</label>
      <input type="text" id="numero" class="form-control">
    </div>

    <div class="mb-3">
      <label>Bairro</label>
      <input type="text" id="bairro" class="form-control">
    </div>

    <div class="mb-3">
      <label>Cidade</label>
      <input type="text" id="cidade" class="form-control">
    </div>

    <div class="mb-3">
      <label>Estado</label>
      <input type="text" id="estado" class="form-control">
    </div>

  </form>
</div>

<!-- Scripts -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.mask/1.14.16/jquery.mask.min.js"></script>
<script>
$(document).ready(function () {
  // 游늷 M치scara para CEP
  $('#cep').mask('00000-000');

  // 游늷 M치scara din칙mica para CPF/CNPJ
  const cpfCnpjField = $('#cpf_cnpj');

  function aplicarMascaraCpfCnpj() {
    const val = cpfCnpjField.val().replace(/\D/g, '');

    cpfCnpjField.unmask();
    if (val.length <= 11) {
      cpfCnpjField.mask('000.000.000-00'); // CPF
    } else {
      cpfCnpjField.mask('00.000.000/0000-00'); // CNPJ
    }
  }

  // Aplica m치scara ao sair do campo ou colar
  cpfCnpjField.on('blur', aplicarMascaraCpfCnpj);
  cpfCnpjField.on('paste', function () {
    setTimeout(aplicarMascaraCpfCnpj, 100);
  });

  // 游댌 Busca dados da empresa via CNPJ
  $('#buscar_cnpj').on('click', function () {
    const doc = cpfCnpjField.val().replace(/\D/g, '');
    if (doc.length === 14) {
      fetch(`https://publica.cnpj.ws/cnpj/${doc}`)
        .then(response => {
          if (!response.ok) throw new Error("Erro na resposta da API");
          return response.json();
        })
        .then(data => {
          $('#razao_social').val(data.razao_social || '');
          $('#nome_fantasia').val(data.nome_fantasia || '');
          $('#cep').val(data.estabelecimento?.cep || '');
          $('#logradouro').val(data.estabelecimento?.logradouro || '');
          $('#numero').val(data.estabelecimento?.numero || '');
          $('#bairro').val(data.estabelecimento?.bairro || '');
          $('#cidade').val(data.estabelecimento?.cidade?.nome || '');
          $('#estado').val(data.estabelecimento?.estado?.sigla || '');
        })
        .catch(error => {
          console.error("Erro na requisi칞칚o:", error);
          alert("Erro ao buscar CNPJ.");
        });
    } else {
      alert("Digite um CNPJ v치lido com 14 d칤gitos.");
    }
  });

  // 游늸 Busca endere칞o pelo CEP
  $('#cep').on('blur', function () {
    const cep = $(this).val().replace(/\D/g, '');
    if (cep.length === 8) {
      fetch(`https://viacep.com.br/ws/${cep}/json/`)
        .then(response => response.json())
        .then(e => {
          $('#logradouro').val(e.logradouro || '');
          $('#numero').val('');
          $('#bairro').val(e.bairro || '');
          $('#cidade').val(e.localidade || '');
          $('#estado').val(e.uf || '');
          $('#cep').val(e.cep || '');
        })
        .catch(error => console.error("Erro ao buscar CEP:", error));
    }
  });
});
</script>
</body>
</html>